export function parseXMessage(raw) {
    const fieldValues = {};
    let f = undefined;
    let m = 0;
    for (const data of raw[1]){
        if (m % 2 === 0) {
            f = data;
        } else if (f) {
            fieldValues[f] = data;
        }
        m++;
    }
    return {
        xid: parseXId(raw[0]),
        fieldValues: fieldValues
    };
}
export function convertMap(raw) {
    const fieldValues = new Map();
    let f = undefined;
    let m = 0;
    for (const data of raw){
        if (m % 2 === 0 && typeof data === "string") {
            f = data;
        } else if (m % 2 === 1 && f) {
            fieldValues.set(f, data);
        }
        m++;
    }
    return fieldValues;
}
export function parseXReadReply(raw) {
    const out = [];
    for (const [key, idData] of raw ?? []){
        const messages = [];
        for (const rawMsg of idData){
            messages.push(parseXMessage(rawMsg));
        }
        out.push({
            key,
            messages
        });
    }
    return out;
}
export function parseXId(raw) {
    const [ms, sn] = raw.split("-");
    return {
        unixMs: parseInt(ms),
        seqNo: parseInt(sn)
    };
}
export function parseXPendingConsumers(raws) {
    const out = [];
    for (const raw of raws){
        if (isCondArray(raw) && isString(raw[0]) && isString(raw[1])) {
            out.push({
                name: raw[0],
                pending: parseInt(raw[1])
            });
        }
    }
    return out;
}
export function parseXPendingCounts(raw) {
    const infos = [];
    for (const r of raw){
        if (isCondArray(r) && isString(r[0]) && isString(r[1]) && isNumber(r[2]) && isNumber(r[3])) {
            infos.push({
                xid: parseXId(r[0]),
                owner: r[1],
                lastDeliveredMs: r[2],
                timesDelivered: r[3]
            });
        }
    }
    return infos;
}
export function parseXGroupDetail(rawGroups) {
    const out = [];
    for (const rawGroup of rawGroups){
        if (isCondArray(rawGroup)) {
            const data = convertMap(rawGroup);
            // array of arrays
            const consDeets = data.get("consumers");
            out.push({
                name: rawstr(data.get("name") ?? null),
                lastDeliveredId: parseXId(rawstr(data.get("last-delivered-id") ?? null)),
                pelCount: rawnum(data.get("pel-count") ?? null),
                pending: parseXPendingCounts(data.get("pending")),
                consumers: parseXConsumerDetail(consDeets)
            });
        }
    }
    return out;
}
export function parseXConsumerDetail(nestedRaws) {
    const out = [];
    for (const raws of nestedRaws){
        const data = convertMap(raws);
        const pending = data.get("pending").map((p)=>{
            return {
                xid: parseXId(rawstr(p[0])),
                lastDeliveredMs: rawnum(p[1]),
                timesDelivered: rawnum(p[2])
            };
        });
        const r = {
            name: rawstr(data.get("name") ?? null),
            seenTime: rawnum(data.get("seen-time") ?? null),
            pelCount: rawnum(data.get("pel-count") ?? null),
            pending
        };
        out.push(r);
    }
    return out;
}
export function xidstr(xid) {
    if (typeof xid === "string") return xid;
    if (typeof xid === "number") return `${xid}-0`;
    if (xid instanceof Array && xid.length > 1) return `${xid[0]}-${xid[1]}`;
    if (isXId(xid)) return `${xid.unixMs}-${xid.seqNo}`;
    throw "fail";
}
export function rawnum(raw) {
    return raw ? +raw.toString() : 0;
}
export function rawstr(raw) {
    return raw ? raw.toString() : "";
}
// deno-lint-ignore no-explicit-any
export function isString(x) {
    return typeof x === "string";
}
// deno-lint-ignore no-explicit-any
export function isNumber(x) {
    return typeof x === "number";
}
export function isCondArray(x) {
    const l = x.length;
    if (l > 0 || l < 1) return true;
    else return false;
}
function isXId(xid) {
    return xid.unixMs !== undefined;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvcmVkaXNAdjAuMzIuNC9zdHJlYW0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUge1xuICBDb25kaXRpb25hbEFycmF5LFxuICBSYXcsXG4gIFJlZGlzVmFsdWUsXG59IGZyb20gXCIuL3Byb3RvY29sL3NoYXJlZC90eXBlcy50c1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFhJZCB7XG4gIHVuaXhNczogbnVtYmVyO1xuICBzZXFObzogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFhNZXNzYWdlIHtcbiAgeGlkOiBYSWQ7XG4gIGZpZWxkVmFsdWVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFhLZXlJZCB7XG4gIGtleTogc3RyaW5nO1xuICB4aWQ6IFhJZElucHV0O1xufVxuXG5leHBvcnQgdHlwZSBYS2V5SWRMaWtlID0gW3N0cmluZywgWElkSW5wdXRdO1xuXG5leHBvcnQgaW50ZXJmYWNlIFhLZXlJZEdyb3VwIHtcbiAga2V5OiBzdHJpbmc7XG4gIHhpZDogWElkR3JvdXBSZWFkO1xufVxuXG5leHBvcnQgdHlwZSBYS2V5SWRHcm91cExpa2UgPSBbc3RyaW5nLCBYSWRHcm91cFJlYWRdO1xuXG5leHBvcnQgdHlwZSBYUmVhZFN0cmVhbSA9IHsga2V5OiBzdHJpbmc7IG1lc3NhZ2VzOiBYTWVzc2FnZVtdIH07XG5leHBvcnQgdHlwZSBYUmVhZFJlcGx5ID0gWFJlYWRTdHJlYW1bXTtcblxuLy8gYmFzaWMgZGF0YSByZXR1cm5lZCBieSByZWRpc1xuZXhwb3J0IHR5cGUgWFJlYWRJZERhdGEgPSBbc3RyaW5nLCBzdHJpbmdbXV07XG5leHBvcnQgdHlwZSBYUmVhZFN0cmVhbVJhdyA9IFtzdHJpbmcsIFhSZWFkSWREYXRhW11dO1xuZXhwb3J0IHR5cGUgWFJlYWRSZXBseVJhdyA9IFhSZWFkU3RyZWFtUmF3W107XG5cbi8qKiBGbGV4aWJsZSBpbnB1dCB0eXBlIGZvciBjb21tYW5kcyB3aGljaCByZXF1aXJlIG1lc3NhZ2VcbiAqIElEIHRvIGJlIHBhc3NlZCAocmVwcmVzZW50ZWQgaW4gbG93ZXItbGV2ZWwgUmVkaXMgQVBJIGFzXG4gKiBcIjEwMDAtMFwiIGV0YykuXG4gKlxuICogV2UgYWxzbyBpbmNsdWRlIGFuIGFycmF5IGZvcm1hdCBmb3IgZWFzZSBvZiB1c2UsIHdoZXJlXG4gKiB0aGUgZmlyc3QgZWxlbWVudCBpcyB0aGUgZXBvY2hNaWxsaXMsIHNlY29uZCBpcyBzZXFOby5cbiAqXG4gKiBXZSBhbHNvIGFsbG93IHBhc3NpbmcgYSBzaW5nbGUgbnVtYmVyLFxuICogd2hpY2ggd2lsbCByZXByZXNlbnQgdGhlIHRoZSBlcG9jaCBNaWxsaXMgd2l0aFxuICogc2VxTm8gb2YgemVyby4gIChFc3BlY2lhbGx5IHVzZWZ1bCBpcyB0byBwYXNzIDAuKVxuICovXG5leHBvcnQgdHlwZSBYSWRJbnB1dCA9IFhJZCB8IFtudW1iZXIsIG51bWJlcl0gfCBudW1iZXIgfCBzdHJpbmc7XG4vKipcbiAqIElEIGlucHV0IHR5cGUgZm9yIFhBREQsIHdoaWNoIGlzIGFsbG93ZWQgdG8gaW5jbHVkZSB0aGVcbiAqIFwiKlwiIG9wZXJhdG9yLiAqL1xuZXhwb3J0IHR5cGUgWElkQWRkID0gWElkSW5wdXQgfCBcIipcIjtcbi8qKlxuICogSUQgaW5wdXQgdHlwZSBmb3IgWEdST1VQUkVBRCwgd2hpY2ggaXMgYWxsb3dlZCB0byBpbmNsdWRlXG4gKiB0aGUgXCI+XCIgb3BlcmF0b3IuICBXZSBpbmNsdWRlIGFuIGFycmF5IGZvcm1hdCBmb3IgZWFzZSBvZlxuICogdXNlLCB3aGVyZSB0aGUgZmlyc3QgZWxlbWVudCBpcyB0aGUgZXBvY2hNaWxsaXMsIHNlY29uZFxuICogaXMgc2VxTm8uICovXG5leHBvcnQgdHlwZSBYSWRHcm91cFJlYWQgPSBYSWRJbnB1dCB8IFwiPlwiO1xuXG4vKiogQWxsb3dzIHNwZWNpYWwgbWF4aW11bSBJRCBmb3IgWFJBTkdFIGFuZCBYUkVWUkFOR0UgKi9cbmV4cG9ydCB0eXBlIFhJZFBvcyA9IFhJZElucHV0IHwgXCIrXCI7XG4vKiogQWxsb3dzIHNwZWNpYWwgbWluaW11bSBJRCBmb3IgWFJBTkdFIGFuZCBYUkVWUkFOR0UgKi9cbmV4cG9ydCB0eXBlIFhJZE5lZyA9IFhJZElucHV0IHwgXCItXCI7XG4vKiogQWxsb3cgc3BlY2lhbCAkIElEIGZvciBYR1JPVVAgQ1JFQVRFICovXG5leHBvcnQgdHlwZSBYSWRDcmVhdGVHcm91cCA9IFhJZElucHV0IHwgXCIkXCI7XG5cbmV4cG9ydCB0eXBlIFhBZGRGaWVsZFZhbHVlcyA9XG4gIHwgUmVjb3JkPHN0cmluZyB8IG51bWJlciwgUmVkaXNWYWx1ZT5cbiAgfCBNYXA8c3RyaW5nIHwgbnVtYmVyLCBSZWRpc1ZhbHVlPjtcblxuZXhwb3J0IGludGVyZmFjZSBYUmVhZE9wdHMge1xuICBjb3VudD86IG51bWJlcjtcbiAgYmxvY2s/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgWFJlYWRHcm91cE9wdHMge1xuICBncm91cDogc3RyaW5nO1xuICBjb25zdW1lcjogc3RyaW5nO1xuICBjb3VudD86IG51bWJlcjtcbiAgYmxvY2s/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgWE1heGxlbiB7XG4gIGFwcHJveD86IGJvb2xlYW47XG4gIGVsZW1lbnRzOiBudW1iZXI7XG59XG5cbmV4cG9ydCB0eXBlIFhDbGFpbVJlcGx5ID0gWENsYWltTWVzc2FnZXMgfCBYQ2xhaW1KdXN0WElkO1xuZXhwb3J0IGludGVyZmFjZSBYQ2xhaW1NZXNzYWdlcyB7XG4gIGtpbmQ6IFwibWVzc2FnZXNcIjtcbiAgbWVzc2FnZXM6IFhNZXNzYWdlW107XG59XG5leHBvcnQgaW50ZXJmYWNlIFhDbGFpbUp1c3RYSWQge1xuICBraW5kOiBcImp1c3R4aWRcIjtcbiAgeGlkczogWElkW107XG59XG5cbi8qKlxuICogQHBhcmFtIGNvdW50IExpbWl0IG9uIHRoZSBudW1iZXIgb2YgbWVzc2FnZXMgdG8gcmV0dXJuIHBlciBjYWxsLlxuICogQHBhcmFtIHN0YXJ0SWQgSUQgZm9yIHRoZSBmaXJzdCBwZW5kaW5nIHJlY29yZC5cbiAqIEBwYXJhbSBlbmRJZCAgSUQgZm9yIHRoZSBmaW5hbCBwZW5kaW5nIHJlY29yZC5cbiAqIEBwYXJhbSBjb25zdW1lcnMgIEV2ZXJ5IGNvbnN1bWVyIGluIHRoZSBjb25zdW1lciBncm91cFxuICogd2l0aCBhdCBsZWFzdCBvbmUgcGVuZGluZyBtZXNzYWdlLCBhbmQgdGhlIG51bWJlciBvZlxuICogcGVuZGluZyBtZXNzYWdlcyBpdCBoYXMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgWFBlbmRpbmdSZXBseSB7XG4gIGNvdW50OiBudW1iZXI7XG4gIHN0YXJ0SWQ6IFhJZDtcbiAgZW5kSWQ6IFhJZDtcbiAgY29uc3VtZXJzOiBYUGVuZGluZ0NvbnN1bWVyW107XG59XG5leHBvcnQgaW50ZXJmYWNlIFhQZW5kaW5nQ29uc3VtZXIge1xuICBuYW1lOiBzdHJpbmc7XG4gIHBlbmRpbmc6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgcGVuZGluZyBtZXNzYWdlIHBhcnNlZCBmcm9tIHhwZW5kaW5nLlxuICpcbiAqIEBwYXJhbSBpZCBUaGUgSUQgb2YgdGhlIG1lc3NhZ2VcbiAqIEBwYXJhbSBjb25zdW1lciBUaGUgbmFtZSBvZiB0aGUgY29uc3VtZXIgdGhhdCBmZXRjaGVkIHRoZSBtZXNzYWdlXG4gKiAgYW5kIGhhcyBzdGlsbCB0byBhY2tub3dsZWRnZSBpdC4gV2UgY2FsbCBpdCB0aGVcbiAqICBjdXJyZW50IG93bmVyIG9mIHRoZSBtZXNzYWdlLlxuICogQHBhcmFtIGxhc3REZWxpdmVyZWRNcyBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0aGF0IGVsYXBzZWQgc2luY2UgdGhlXG4gKiAgbGFzdCB0aW1lIHRoaXMgbWVzc2FnZSB3YXMgZGVsaXZlcmVkIHRvIHRoaXMgY29uc3VtZXIuXG4gKiBAcGFyYW0gdGltZXNEZWxpdmVyZWQgVGhlIG51bWJlciBvZiB0aW1lcyB0aGlzIG1lc3NhZ2Ugd2FzIGRlbGl2ZXJlZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBYUGVuZGluZ0NvdW50IHtcbiAgeGlkOiBYSWQ7XG4gIG93bmVyOiBzdHJpbmc7XG4gIGxhc3REZWxpdmVyZWRNczogbnVtYmVyO1xuICB0aW1lc0RlbGl2ZXJlZDogbnVtYmVyO1xufVxuLyoqIFVzZWQgaW4gdGhlIFhQRU5ESU5HIGNvbW1hbmQsIGFsbCB0aHJlZSBvZiB0aGVzZVxuICogYXJncyBtdXN0IGJlIHNwZWNpZmllZCBpZiBfYW55XyBhcmUgc3BlY2lmaWVkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFN0YXJ0RW5kQ291bnQge1xuICBzdGFydDogWElkTmVnO1xuICBlbmQ6IFhJZFBvcztcbiAgY291bnQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBYSW5mb1N0cmVhbVJlcGx5IHtcbiAgbGVuZ3RoOiBudW1iZXI7XG4gIHJhZGl4VHJlZUtleXM6IG51bWJlcjtcbiAgcmFkaXhUcmVlTm9kZXM6IG51bWJlcjtcbiAgZ3JvdXBzOiBudW1iZXI7XG4gIGxhc3RHZW5lcmF0ZWRJZDogWElkO1xuICBmaXJzdEVudHJ5OiBYTWVzc2FnZTtcbiAgbGFzdEVudHJ5OiBYTWVzc2FnZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBYSW5mb1N0cmVhbUZ1bGxSZXBseSB7XG4gIGxlbmd0aDogbnVtYmVyO1xuICByYWRpeFRyZWVLZXlzOiBudW1iZXI7XG4gIHJhZGl4VHJlZU5vZGVzOiBudW1iZXI7XG4gIGxhc3RHZW5lcmF0ZWRJZDogWElkO1xuICBlbnRyaWVzOiBYTWVzc2FnZVtdO1xuICBncm91cHM6IFhHcm91cERldGFpbFtdO1xufVxuXG4vKipcbiAqIENoaWxkIG9mIHRoZSByZXR1cm4gdHlwZSBmb3IgeGluZm9fc3RyZWFtX2Z1bGxcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBYR3JvdXBEZXRhaWwge1xuICBuYW1lOiBzdHJpbmc7XG4gIGxhc3REZWxpdmVyZWRJZDogWElkO1xuICBwZWxDb3VudDogbnVtYmVyO1xuICBwZW5kaW5nOiBYUGVuZGluZ0NvdW50W107XG4gIGNvbnN1bWVyczogWENvbnN1bWVyRGV0YWlsW107XG59XG4vKiogQ2hpbGQgb2YgWElORk8gU1RSRUFNUyBGVUxMIHJlc3BvbnNlICovXG5leHBvcnQgaW50ZXJmYWNlIFhDb25zdW1lckRldGFpbCB7XG4gIG5hbWU6IHN0cmluZztcbiAgc2VlblRpbWU6IG51bWJlcjtcbiAgcGVsQ291bnQ6IG51bWJlcjtcbiAgcGVuZGluZzogeyB4aWQ6IFhJZDsgbGFzdERlbGl2ZXJlZE1zOiBudW1iZXI7IHRpbWVzRGVsaXZlcmVkOiBudW1iZXIgfVtdO1xufVxuXG5leHBvcnQgdHlwZSBYSW5mb0NvbnN1bWVyc1JlcGx5ID0gWEluZm9Db25zdW1lcltdO1xuLyoqXG4gKiBBIGNvbnN1bWVyIHBhcnNlZCBmcm9tIHhpbmZvIGNvbW1hbmQuXG4gKlxuICogQHBhcmFtIG5hbWUgTmFtZSBvZiB0aGUgY29uc3VtZXIgZ3JvdXAuXG4gKiBAcGFyYW0gcGVuZGluZyBOdW1iZXIgb2YgcGVuZGluZyBtZXNzYWdlcyBmb3IgdGhpcyBzcGVjaWZpYyBjb25zdW1lci5cbiAqIEBwYXJhbSBpZGxlIFRoaXMgY29uc3VtZXIncyBpZGxlIHRpbWUgaW4gbWlsbGlzZWNvbmRzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFhJbmZvQ29uc3VtZXIge1xuICBuYW1lOiBzdHJpbmc7XG4gIHBlbmRpbmc6IG51bWJlcjtcbiAgaWRsZTogbnVtYmVyO1xufVxuXG4vKiogUmVzcG9uc2UgdG8gWElORk8gR1JPVVBTIDxrZXk+ICovXG5leHBvcnQgdHlwZSBYSW5mb0dyb3Vwc1JlcGx5ID0gWEluZm9Hcm91cFtdO1xuZXhwb3J0IGludGVyZmFjZSBYSW5mb0dyb3VwIHtcbiAgbmFtZTogc3RyaW5nO1xuICBjb25zdW1lcnM6IG51bWJlcjtcbiAgcGVuZGluZzogbnVtYmVyO1xuICBsYXN0RGVsaXZlcmVkSWQ6IFhJZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBYQ2xhaW1PcHRzIHtcbiAgZ3JvdXA6IHN0cmluZztcbiAgY29uc3VtZXI6IHN0cmluZztcbiAgbWluSWRsZVRpbWU6IG51bWJlcjtcbiAgaWRsZT86IG51bWJlcjtcbiAgdGltZT86IG51bWJlcjtcbiAgcmV0cnlDb3VudD86IG51bWJlcjtcbiAgZm9yY2U/OiBib29sZWFuO1xuICBqdXN0WElkPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlWE1lc3NhZ2UocmF3OiBYUmVhZElkRGF0YSk6IFhNZXNzYWdlIHtcbiAgY29uc3QgZmllbGRWYWx1ZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgbGV0IGY6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuICBsZXQgbSA9IDA7XG4gIGZvciAoY29uc3QgZGF0YSBvZiByYXdbMV0pIHtcbiAgICBpZiAobSAlIDIgPT09IDApIHtcbiAgICAgIGYgPSBkYXRhO1xuICAgIH0gZWxzZSBpZiAoZikge1xuICAgICAgZmllbGRWYWx1ZXNbZl0gPSBkYXRhO1xuICAgIH1cbiAgICBtKys7XG4gIH1cblxuICByZXR1cm4geyB4aWQ6IHBhcnNlWElkKHJhd1swXSksIGZpZWxkVmFsdWVzOiBmaWVsZFZhbHVlcyB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29udmVydE1hcChyYXc6IENvbmRpdGlvbmFsQXJyYXkpOiBNYXA8c3RyaW5nLCBSYXc+IHtcbiAgY29uc3QgZmllbGRWYWx1ZXM6IE1hcDxzdHJpbmcsIFJhdz4gPSBuZXcgTWFwKCk7XG4gIGxldCBmOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG5cbiAgbGV0IG0gPSAwO1xuICBmb3IgKGNvbnN0IGRhdGEgb2YgcmF3KSB7XG4gICAgaWYgKG0gJSAyID09PSAwICYmIHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBmID0gZGF0YTtcbiAgICB9IGVsc2UgaWYgKG0gJSAyID09PSAxICYmIGYpIHtcbiAgICAgIGZpZWxkVmFsdWVzLnNldChmLCBkYXRhKTtcbiAgICB9XG4gICAgbSsrO1xuICB9XG5cbiAgcmV0dXJuIGZpZWxkVmFsdWVzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VYUmVhZFJlcGx5KHJhdzogWFJlYWRSZXBseVJhdyk6IFhSZWFkUmVwbHkge1xuICBjb25zdCBvdXQ6IFhSZWFkU3RyZWFtW10gPSBbXTtcbiAgZm9yIChjb25zdCBba2V5LCBpZERhdGFdIG9mIHJhdyA/PyBbXSkge1xuICAgIGNvbnN0IG1lc3NhZ2VzID0gW107XG4gICAgZm9yIChjb25zdCByYXdNc2cgb2YgaWREYXRhKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKHBhcnNlWE1lc3NhZ2UocmF3TXNnKSk7XG4gICAgfVxuICAgIG91dC5wdXNoKHsga2V5LCBtZXNzYWdlcyB9KTtcbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVhJZChyYXc6IHN0cmluZyk6IFhJZCB7XG4gIGNvbnN0IFttcywgc25dID0gcmF3LnNwbGl0KFwiLVwiKTtcbiAgcmV0dXJuIHsgdW5peE1zOiBwYXJzZUludChtcyksIHNlcU5vOiBwYXJzZUludChzbikgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlWFBlbmRpbmdDb25zdW1lcnMoXG4gIHJhd3M6IENvbmRpdGlvbmFsQXJyYXksXG4pOiBYUGVuZGluZ0NvbnN1bWVyW10ge1xuICBjb25zdCBvdXQ6IFhQZW5kaW5nQ29uc3VtZXJbXSA9IFtdO1xuXG4gIGZvciAoY29uc3QgcmF3IG9mIHJhd3MpIHtcbiAgICBpZiAoaXNDb25kQXJyYXkocmF3KSAmJiBpc1N0cmluZyhyYXdbMF0pICYmIGlzU3RyaW5nKHJhd1sxXSkpIHtcbiAgICAgIG91dC5wdXNoKHsgbmFtZTogcmF3WzBdLCBwZW5kaW5nOiBwYXJzZUludChyYXdbMV0pIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVhQZW5kaW5nQ291bnRzKHJhdzogQ29uZGl0aW9uYWxBcnJheSk6IFhQZW5kaW5nQ291bnRbXSB7XG4gIGNvbnN0IGluZm9zOiBYUGVuZGluZ0NvdW50W10gPSBbXTtcbiAgZm9yIChjb25zdCByIG9mIHJhdykge1xuICAgIGlmIChcbiAgICAgIGlzQ29uZEFycmF5KHIpICYmXG4gICAgICBpc1N0cmluZyhyWzBdKSAmJlxuICAgICAgaXNTdHJpbmcoclsxXSkgJiZcbiAgICAgIGlzTnVtYmVyKHJbMl0pICYmXG4gICAgICBpc051bWJlcihyWzNdKVxuICAgICkge1xuICAgICAgaW5mb3MucHVzaCh7XG4gICAgICAgIHhpZDogcGFyc2VYSWQoclswXSksXG4gICAgICAgIG93bmVyOiByWzFdLFxuICAgICAgICBsYXN0RGVsaXZlcmVkTXM6IHJbMl0sXG4gICAgICAgIHRpbWVzRGVsaXZlcmVkOiByWzNdLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGluZm9zO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VYR3JvdXBEZXRhaWwocmF3R3JvdXBzOiBDb25kaXRpb25hbEFycmF5KTogWEdyb3VwRGV0YWlsW10ge1xuICBjb25zdCBvdXQgPSBbXTtcblxuICBmb3IgKGNvbnN0IHJhd0dyb3VwIG9mIHJhd0dyb3Vwcykge1xuICAgIGlmIChpc0NvbmRBcnJheShyYXdHcm91cCkpIHtcbiAgICAgIGNvbnN0IGRhdGEgPSBjb252ZXJ0TWFwKHJhd0dyb3VwKTtcblxuICAgICAgLy8gYXJyYXkgb2YgYXJyYXlzXG4gICAgICBjb25zdCBjb25zRGVldHMgPSBkYXRhLmdldChcImNvbnN1bWVyc1wiKSBhcyBDb25kaXRpb25hbEFycmF5W107XG5cbiAgICAgIG91dC5wdXNoKHtcbiAgICAgICAgbmFtZTogcmF3c3RyKGRhdGEuZ2V0KFwibmFtZVwiKSA/PyBudWxsKSxcbiAgICAgICAgbGFzdERlbGl2ZXJlZElkOiBwYXJzZVhJZChcbiAgICAgICAgICByYXdzdHIoZGF0YS5nZXQoXCJsYXN0LWRlbGl2ZXJlZC1pZFwiKSA/PyBudWxsKSxcbiAgICAgICAgKSxcbiAgICAgICAgcGVsQ291bnQ6IHJhd251bShkYXRhLmdldChcInBlbC1jb3VudFwiKSA/PyBudWxsKSxcbiAgICAgICAgcGVuZGluZzogcGFyc2VYUGVuZGluZ0NvdW50cyhkYXRhLmdldChcInBlbmRpbmdcIikgYXMgQ29uZGl0aW9uYWxBcnJheSksXG4gICAgICAgIGNvbnN1bWVyczogcGFyc2VYQ29uc3VtZXJEZXRhaWwoY29uc0RlZXRzKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVhDb25zdW1lckRldGFpbChuZXN0ZWRSYXdzOiBSYXdbXVtdKTogWENvbnN1bWVyRGV0YWlsW10ge1xuICBjb25zdCBvdXQ6IFhDb25zdW1lckRldGFpbFtdID0gW107XG5cbiAgZm9yIChjb25zdCByYXdzIG9mIG5lc3RlZFJhd3MpIHtcbiAgICBjb25zdCBkYXRhID0gY29udmVydE1hcChyYXdzKTtcblxuICAgIGNvbnN0IHBlbmRpbmcgPSAoZGF0YS5nZXQoXCJwZW5kaW5nXCIpIGFzIFtzdHJpbmcsIG51bWJlciwgbnVtYmVyXVtdKS5tYXAoXG4gICAgICAocCkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHhpZDogcGFyc2VYSWQocmF3c3RyKHBbMF0pKSxcbiAgICAgICAgICBsYXN0RGVsaXZlcmVkTXM6IHJhd251bShwWzFdKSxcbiAgICAgICAgICB0aW1lc0RlbGl2ZXJlZDogcmF3bnVtKHBbMl0pLFxuICAgICAgICB9O1xuICAgICAgfSxcbiAgICApO1xuXG4gICAgY29uc3QgciA9IHtcbiAgICAgIG5hbWU6IHJhd3N0cihkYXRhLmdldChcIm5hbWVcIikgPz8gbnVsbCksXG4gICAgICBzZWVuVGltZTogcmF3bnVtKGRhdGEuZ2V0KFwic2Vlbi10aW1lXCIpID8/IG51bGwpLFxuICAgICAgcGVsQ291bnQ6IHJhd251bShkYXRhLmdldChcInBlbC1jb3VudFwiKSA/PyBudWxsKSxcbiAgICAgIHBlbmRpbmcsXG4gICAgfTtcblxuICAgIG91dC5wdXNoKHIpO1xuICB9XG5cbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHhpZHN0cihcbiAgeGlkOiBYSWRBZGQgfCBYSWROZWcgfCBYSWRQb3MgfCBYSWRDcmVhdGVHcm91cCB8IFhJZEdyb3VwUmVhZCxcbikge1xuICBpZiAodHlwZW9mIHhpZCA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIHhpZDtcbiAgaWYgKHR5cGVvZiB4aWQgPT09IFwibnVtYmVyXCIpIHJldHVybiBgJHt4aWR9LTBgO1xuICBpZiAoeGlkIGluc3RhbmNlb2YgQXJyYXkgJiYgeGlkLmxlbmd0aCA+IDEpIHJldHVybiBgJHt4aWRbMF19LSR7eGlkWzFdfWA7XG4gIGlmIChpc1hJZCh4aWQpKSByZXR1cm4gYCR7eGlkLnVuaXhNc30tJHt4aWQuc2VxTm99YDtcbiAgdGhyb3cgXCJmYWlsXCI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByYXdudW0ocmF3OiBSYXcpOiBudW1iZXIge1xuICByZXR1cm4gcmF3ID8gK3Jhdy50b1N0cmluZygpIDogMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiByYXdzdHIocmF3OiBSYXcpOiBzdHJpbmcge1xuICByZXR1cm4gcmF3ID8gcmF3LnRvU3RyaW5nKCkgOiBcIlwiO1xufVxuLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbmV4cG9ydCBmdW5jdGlvbiBpc1N0cmluZyh4OiBhbnkpOiB4IGlzIHN0cmluZyB7XG4gIHJldHVybiB0eXBlb2YgeCA9PT0gXCJzdHJpbmdcIjtcbn1cblxuLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbmV4cG9ydCBmdW5jdGlvbiBpc051bWJlcih4OiBhbnkpOiB4IGlzIG51bWJlciB7XG4gIHJldHVybiB0eXBlb2YgeCA9PT0gXCJudW1iZXJcIjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzQ29uZEFycmF5KHg6IFJhdyk6IHggaXMgQ29uZGl0aW9uYWxBcnJheSB7XG4gIGNvbnN0IGwgPSAoeCBhcyBDb25kaXRpb25hbEFycmF5KS5sZW5ndGg7XG4gIGlmIChsID4gMCB8fCBsIDwgMSkgcmV0dXJuIHRydWU7XG4gIGVsc2UgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBpc1hJZCh4aWQ6IFhJZEFkZCk6IHhpZCBpcyBYSWQge1xuICByZXR1cm4gKHhpZCBhcyBYSWQpLnVuaXhNcyAhPT0gdW5kZWZpbmVkO1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXVOQSxPQUFPLFNBQVMsY0FBYyxHQUFnQixFQUFZO0lBQ3hELE1BQU0sY0FBc0MsQ0FBQztJQUM3QyxJQUFJLElBQXdCO0lBRTVCLElBQUksSUFBSTtJQUNSLEtBQUssTUFBTSxRQUFRLEdBQUcsQ0FBQyxFQUFFLENBQUU7UUFDekIsSUFBSSxJQUFJLE1BQU0sR0FBRztZQUNmLElBQUk7UUFDTixPQUFPLElBQUksR0FBRztZQUNaLFdBQVcsQ0FBQyxFQUFFLEdBQUc7UUFDbkIsQ0FBQztRQUNEO0lBQ0Y7SUFFQSxPQUFPO1FBQUUsS0FBSyxTQUFTLEdBQUcsQ0FBQyxFQUFFO1FBQUcsYUFBYTtJQUFZO0FBQzNELENBQUM7QUFFRCxPQUFPLFNBQVMsV0FBVyxHQUFxQixFQUFvQjtJQUNsRSxNQUFNLGNBQWdDLElBQUk7SUFDMUMsSUFBSSxJQUF3QjtJQUU1QixJQUFJLElBQUk7SUFDUixLQUFLLE1BQU0sUUFBUSxJQUFLO1FBQ3RCLElBQUksSUFBSSxNQUFNLEtBQUssT0FBTyxTQUFTLFVBQVU7WUFDM0MsSUFBSTtRQUNOLE9BQU8sSUFBSSxJQUFJLE1BQU0sS0FBSyxHQUFHO1lBQzNCLFlBQVksR0FBRyxDQUFDLEdBQUc7UUFDckIsQ0FBQztRQUNEO0lBQ0Y7SUFFQSxPQUFPO0FBQ1QsQ0FBQztBQUVELE9BQU8sU0FBUyxnQkFBZ0IsR0FBa0IsRUFBYztJQUM5RCxNQUFNLE1BQXFCLEVBQUU7SUFDN0IsS0FBSyxNQUFNLENBQUMs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