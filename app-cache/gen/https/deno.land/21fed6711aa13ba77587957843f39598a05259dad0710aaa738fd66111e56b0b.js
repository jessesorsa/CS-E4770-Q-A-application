import { BufReader } from "../../vendor/https/deno.land/std/io/buf_reader.ts";
import { BufWriter } from "../../vendor/https/deno.land/std/io/buf_writer.ts";
import { readReply } from "./reply.ts";
import { sendCommand, sendCommands, writeCommand } from "./command.ts";
export class Protocol {
    #reader;
    #writer;
    constructor(conn){
        this.#reader = new BufReader(conn);
        this.#writer = new BufWriter(conn);
    }
    sendCommand(command, args, returnsUint8Arrays) {
        return sendCommand(this.#writer, this.#reader, command, args, returnsUint8Arrays);
    }
    readReply(returnsUint8Arrays) {
        return readReply(this.#reader, returnsUint8Arrays);
    }
    async writeCommand(command) {
        await writeCommand(this.#writer, command.command, command.args);
        await this.#writer.flush();
    }
    pipeline(commands) {
        return sendCommands(this.#writer, this.#reader, commands);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvcmVkaXNAdjAuMzIuNC9wcm90b2NvbC9kZW5vX3N0cmVhbXMvbW9kLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJ1ZlJlYWRlciB9IGZyb20gXCIuLi8uLi92ZW5kb3IvaHR0cHMvZGVuby5sYW5kL3N0ZC9pby9idWZfcmVhZGVyLnRzXCI7XG5pbXBvcnQgeyBCdWZXcml0ZXIgfSBmcm9tIFwiLi4vLi4vdmVuZG9yL2h0dHBzL2Rlbm8ubGFuZC9zdGQvaW8vYnVmX3dyaXRlci50c1wiO1xuaW1wb3J0IHsgcmVhZFJlcGx5IH0gZnJvbSBcIi4vcmVwbHkudHNcIjtcbmltcG9ydCB7IHNlbmRDb21tYW5kLCBzZW5kQ29tbWFuZHMsIHdyaXRlQ29tbWFuZCB9IGZyb20gXCIuL2NvbW1hbmQudHNcIjtcblxuaW1wb3J0IHR5cGUgeyBDb21tYW5kLCBQcm90b2NvbCBhcyBCYXNlUHJvdG9jb2wgfSBmcm9tIFwiLi4vc2hhcmVkL3Byb3RvY29sLnRzXCI7XG5pbXBvcnQgeyBSZWRpc1JlcGx5LCBSZWRpc1ZhbHVlIH0gZnJvbSBcIi4uL3NoYXJlZC90eXBlcy50c1wiO1xuaW1wb3J0IHsgRXJyb3JSZXBseUVycm9yIH0gZnJvbSBcIi4uLy4uL2Vycm9ycy50c1wiO1xuXG5leHBvcnQgY2xhc3MgUHJvdG9jb2wgaW1wbGVtZW50cyBCYXNlUHJvdG9jb2wge1xuICAjcmVhZGVyOiBCdWZSZWFkZXI7XG4gICN3cml0ZXI6IEJ1ZldyaXRlcjtcblxuICBjb25zdHJ1Y3Rvcihjb25uOiBEZW5vLkNvbm4pIHtcbiAgICB0aGlzLiNyZWFkZXIgPSBuZXcgQnVmUmVhZGVyKGNvbm4pO1xuICAgIHRoaXMuI3dyaXRlciA9IG5ldyBCdWZXcml0ZXIoY29ubik7XG4gIH1cblxuICBzZW5kQ29tbWFuZChcbiAgICBjb21tYW5kOiBzdHJpbmcsXG4gICAgYXJnczogUmVkaXNWYWx1ZVtdLFxuICAgIHJldHVybnNVaW50OEFycmF5cz86IGJvb2xlYW4gfCB1bmRlZmluZWQsXG4gICk6IFByb21pc2U8UmVkaXNSZXBseT4ge1xuICAgIHJldHVybiBzZW5kQ29tbWFuZChcbiAgICAgIHRoaXMuI3dyaXRlcixcbiAgICAgIHRoaXMuI3JlYWRlcixcbiAgICAgIGNvbW1hbmQsXG4gICAgICBhcmdzLFxuICAgICAgcmV0dXJuc1VpbnQ4QXJyYXlzLFxuICAgICk7XG4gIH1cblxuICByZWFkUmVwbHkocmV0dXJuc1VpbnQ4QXJyYXlzPzogYm9vbGVhbik6IFByb21pc2U8UmVkaXNSZXBseT4ge1xuICAgIHJldHVybiByZWFkUmVwbHkodGhpcy4jcmVhZGVyLCByZXR1cm5zVWludDhBcnJheXMpO1xuICB9XG5cbiAgYXN5bmMgd3JpdGVDb21tYW5kKGNvbW1hbmQ6IENvbW1hbmQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB3cml0ZUNvbW1hbmQodGhpcy4jd3JpdGVyLCBjb21tYW5kLmNvbW1hbmQsIGNvbW1hbmQuYXJncyk7XG4gICAgYXdhaXQgdGhpcy4jd3JpdGVyLmZsdXNoKCk7XG4gIH1cblxuICBwaXBlbGluZShjb21tYW5kczogQ29tbWFuZFtdKTogUHJvbWlzZTxBcnJheTxSZWRpc1JlcGx5IHwgRXJyb3JSZXBseUVycm9yPj4ge1xuICAgIHJldHVybiBzZW5kQ29tbWFuZHModGhpcy4jd3JpdGVyLCB0aGlzLiNyZWFkZXIsIGNvbW1hbmRzKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFNBQVMsU0FBUyxRQUFRLG9EQUFvRDtBQUM5RSxTQUFTLFNBQVMsUUFBUSxvREFBb0Q7QUFDOUUsU0FBUyxTQUFTLFFBQVEsYUFBYTtBQUN2QyxTQUFTLFdBQVcsRUFBRSxZQUFZLEVBQUUsWUFBWSxRQUFRLGVBQWU7QUFNdkUsT0FBTyxNQUFNO0lBQ1gsQ0FBQyxNQUFNLENBQVk7SUFDbkIsQ0FBQyxNQUFNLENBQVk7SUFFbkIsWUFBWSxJQUFlLENBQUU7UUFDM0IsSUFBSSxDQUFDLENBQUMsTUFBTSxHQUFHLElBQUksVUFBVTtRQUM3QixJQUFJLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxVQUFVO0lBQy9CO0lBRUEsWUFDRSxPQUFlLEVBQ2YsSUFBa0IsRUFDbEIsa0JBQXdDLEVBQ25CO1FBQ3JCLE9BQU8sWUFDTCxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQ1osSUFBSSxDQUFDLENBQUMsTUFBTSxFQUNaLFNBQ0EsTUFDQTtJQUVKO0lBRUEsVUFBVSxrQkFBNEIsRUFBdUI7UUFDM0QsT0FBTyxVQUFVLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNqQztJQUVBLE1BQU0sYUFBYSxPQUFnQixFQUFpQjtRQUNsRCxNQUFNLGFBQWEsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLFFBQVEsT0FBTyxFQUFFLFFBQVEsSUFBSTtRQUM5RCxNQUFNLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLO0lBQzFCO0lBRUEsU0FBUyxRQUFtQixFQUFnRDtRQUMxRSxPQUFPLGFBQWEsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNsRDtBQUNGLENBQUMifQ==